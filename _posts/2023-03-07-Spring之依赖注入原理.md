---
layout: post
title: Springä¹‹ä¾èµ–æ³¨å…¥åŸç†
date: 2023-03-07
tags: [spring]
description: æ¬²ä¹°æ¡‚èŠ±åŒè½½é…’ï¼Œç»ˆä¸ä¼¼ï¼Œå°‘å¹´æ¸¸
---


## Springç‰ˆæœ¬
spring5.3.10

>æ¬¢è¿å…³æ³¨ä¸ªäººå…¬ä¼—å·ã€å¥½å¥½å­¦æŠ€æœ¯ã€‘äº¤æµå­¦ä¹ 

## Springä¸­ä¾èµ–æ³¨å…¥æœ‰ä¸¤ç§æ–¹å¼

- 1. æ‰‹åŠ¨æ³¨å…¥
- 2. è‡ªåŠ¨æ³¨å…¥

### æ‰‹åŠ¨æ³¨å…¥

é€šè¿‡xmlæ‰‹åŠ¨æ³¨å…¥ã€‚

```xml
<bean name="userService" class="com.fandf.service.UserService">
  <property name="orderService" ref="orderService"/>
</bean>
```

ä¸Šé¢è¿™ç§åº•å±‚å…¶å®æ˜¯é€šè¿‡setæ–¹æ³•è¿›è¡Œæ³¨å…¥çš„ã€‚

```xml
<bean name="userService" class="com.fandf.service.UserService">
  <constructor-arg index="0" ref="orderService"/>
</bean>
```

ä¸Šé¢è¿™ç§åº•å±‚å…¶å®æ˜¯é€šè¿‡æ„é€ æ–¹æ³•è¿›è¡Œæ³¨å…¥çš„ã€‚

### è‡ªåŠ¨æ³¨å…¥

è‡ªåŠ¨æ³¨å…¥çš„æ–¹å¼ä¹Ÿåˆ†ä¸ºä¸¤ç§ï¼š
- 1. xmlçš„autowireè‡ªåŠ¨æ³¨å…¥ã€‚
- 2. @Autowiredæ³¨è§£çš„è‡ªåŠ¨æ³¨å…¥ã€‚

#### xmlçš„autowireè‡ªåŠ¨æ³¨å…¥

å®šä¹‰beançš„æ—¶å€™ï¼Œå¯ä»¥æŒ‡å®šè¿™ä¸ªbeançš„è‡ªåŠ¨æ³¨å…¥æ¨¡å¼ï¼š
- 1. byType
- 2. byName
- 3. constructor
- 4. default
- 5. no

ä¸¾ä¸ªğŸŒ°

```java
<bean id="orderService" class="com.fandf.service.OrderService" autowire="byType"/>
```

Springä¼šè‡ªåŠ¨çš„ç»™orderServiceä¸­æ‰€æœ‰çš„å±æ€§è‡ªåŠ¨èµ‹å€¼(ä¸éœ€è¦è¿™ä¸ªå±æ€§ä¸Šæœ‰@Autowiredæ³¨è§£ï¼Œä½†éœ€è¦è¿™ä¸ªå±æ€§æœ‰å¯¹åº”çš„setæ–¹æ³•)ã€‚

åˆ›å»ºBeançš„è¿‡ç¨‹ä¸­,åœ¨å¡«å……å±æ€§æ—¶,Springä¼šå»è§£æå½“å‰ç±»,æŠŠå½“å‰ç±»çš„æ‰€æœ‰æ–¹æ³•éƒ½è§£æå‡ºæ¥ã€‚Springä¼šå»è§£ææ¯ä¸ªæ–¹æ³•,å¾—åˆ°å¯¹åº”çš„PropertyDescriptorå¯¹è±¡,PropertyDescriptorä¸­æœ‰å‡ ä¸ªå±æ€§ï¼š

- 1. name: å¹¶ä¸æ˜¯æ–¹æ³•çš„åå­—ï¼Œè€Œæ˜¯æ–¹æ³•åå­—å¤„ç†åçš„åå­—
    - å¦‚æœæ–¹æ³•åå­—ä»¥â€œgetâ€å¼€å¤´ï¼Œæ¯”å¦‚â€œgetXXXâ€,é‚£ä¹ˆname=XXX
    - å¦‚æœæ–¹æ³•åå­—ä»¥â€œisâ€å¼€å¤´ï¼Œæ¯”å¦‚â€œisXXXâ€,é‚£ä¹ˆname=XXX
    - å¦‚æœæ–¹æ³•åå­—ä»¥â€œsetâ€å¼€å¤´ï¼Œæ¯”å¦‚â€œsetXXXâ€,é‚£ä¹ˆname=XXX
- 2. readMethodRefï¼šè¡¨ç¤ºgetæ–¹æ³•çš„Methodå¯¹è±¡çš„å¼•ç”¨
- 3. readMethodNameï¼šè¡¨ç¤ºgetæ–¹æ³•çš„åå­—
- 4. writeMethodRefï¼šè¡¨ç¤ºsetæ–¹æ³•çš„Methodå¯¹è±¡çš„å¼•ç”¨
- 5. writeMethodNameï¼šè¡¨ç¤ºsetæ–¹æ³•çš„åå­—
- 6. propertyTypeRefï¼šå¦‚æœæœ‰getæ–¹æ³•é‚£ä¹ˆå¯¹åº”çš„å°±æ˜¯è¿”å›å€¼çš„ç±»å‹ï¼Œå¦‚æœæ˜¯setæ–¹æ³•é‚£ä¹ˆå¯¹åº”çš„å°±æ˜¯setæ–¹æ³•ä¸­å”¯ä¸€å‚æ•°çš„ç±»å‹

> getæ–¹æ³•çš„å®šä¹‰æ˜¯ï¼š æ–¹æ³•å‚æ•°ä¸ªæ•°ä¸º0ä¸ªï¼Œå¹¶ä¸” ï¼ˆæ–¹æ³•åå­—ä»¥"get"å¼€å¤´ æˆ–è€… (æ–¹æ³•åå­—ä»¥"is"å¼€å¤´å¹¶ä¸”æ–¹æ³•çš„è¿”å›ç±»å‹ä¸ºboolean)ï¼‰

> setæ–¹æ³•çš„å®šä¹‰æ˜¯ï¼šæ–¹æ³•å‚æ•°ä¸ªæ•°ä¸º1ä¸ªï¼Œå¹¶ä¸” ï¼ˆæ–¹æ³•åå­—ä»¥"set"å¼€å¤´å¹¶ä¸”æ–¹æ³•è¿”å›ç±»å‹ä¸ºvoidï¼‰

æ‰€ä»¥ï¼ŒSpringåœ¨é€šè¿‡byNameçš„è‡ªåŠ¨å¡«å……å±æ€§æ—¶æµç¨‹æ˜¯ï¼š

- 1. æ‰¾åˆ°æ‰€æœ‰setæ–¹æ³•æ‰€å¯¹åº”çš„XXXéƒ¨åˆ†çš„åå­—
- 2. æ ¹æ®XXXéƒ¨åˆ†çš„åå­—å»è·å–bean

Springåœ¨é€šè¿‡byTypeçš„è‡ªåŠ¨å¡«å……å±æ€§æ—¶æµç¨‹æ˜¯ï¼š

- 1. è·å–åˆ°setæ–¹æ³•ä¸­çš„å”¯ä¸€å‚æ•°çš„å‚æ•°ç±»å‹ï¼Œå¹¶ä¸”æ ¹æ®è¯¥ç±»å‹å»å®¹å™¨ä¸­è·å–bean
- 2. å¦‚æœæ‰¾åˆ°å¤šä¸ªï¼Œä¼šæŠ¥é”™ã€‚

ä»¥ä¸Šï¼Œåˆ†æäº†autowireçš„byTypeå’ŒbyNameæƒ…å†µï¼Œé‚£ä¹ˆæ¥ä¸‹æ¥åˆ†æconstructorï¼Œconstructorè¡¨ç¤ºé€šè¿‡æ„é€ æ–¹æ³•æ³¨å…¥ï¼Œå…¶å®è¿™ç§æƒ…å†µå°±æ¯”è¾ƒç®€å•äº†ï¼Œæ²¡æœ‰byTypeå’ŒbyNameé‚£ä¹ˆå¤æ‚ã€‚
â€‹

å¦‚æœæ˜¯constructorï¼Œé‚£ä¹ˆå°±å¯ä»¥ä¸å†™setæ–¹æ³•äº†ï¼Œå½“æŸä¸ªbeanæ˜¯é€šè¿‡æ„é€ æ–¹æ³•æ¥æ³¨å…¥æ—¶ï¼Œspringåˆ©ç”¨æ„é€ æ–¹æ³•çš„å‚æ•°ä¿¡æ¯ä»Springå®¹å™¨ä¸­å»æ‰¾beanï¼Œæ‰¾åˆ°beanä¹‹åä½œä¸ºå‚æ•°ä¼ ç»™æ„é€ æ–¹æ³•ï¼Œä»è€Œå®ä¾‹åŒ–å¾—åˆ°ä¸€ä¸ªbeanå¯¹è±¡ï¼Œå¹¶å®Œæˆå±æ€§èµ‹å€¼ï¼ˆå±æ€§èµ‹å€¼çš„ä»£ç å¾—è‡ªå·±å†™ï¼‰ã€‚

å…¶å®æ„é€ æ–¹æ³•æ³¨å…¥ç›¸å½“äºbyType+byNameï¼Œæ™®é€šçš„byTypeæ˜¯æ ¹æ®setæ–¹æ³•ä¸­çš„å‚æ•°ç±»å‹å»æ‰¾beanï¼Œæ‰¾åˆ°å¤šä¸ªä¼šæŠ¥é”™ï¼Œè€Œconstructorå°±æ˜¯é€šè¿‡æ„é€ æ–¹æ³•ä¸­çš„å‚æ•°ç±»å‹å»æ‰¾beanï¼Œå¦‚æœæ‰¾åˆ°å¤šä¸ªä¼šæ ¹æ®å‚æ•°åç¡®å®šã€‚

å¦å¤–ä¸¤ä¸ªï¼š

- 1. noï¼Œè¡¨ç¤ºå…³é—­autowire
- 2. defaultï¼Œè¡¨ç¤ºé»˜è®¤å€¼ï¼Œæˆ‘ä»¬ä¸€ç›´æ¼”ç¤ºçš„æŸä¸ªbeançš„autowireï¼Œè€Œä¹Ÿå¯ä»¥ç›´æ¥åœ¨<beans>æ ‡ç­¾ä¸­è®¾ç½®autowireï¼Œå¦‚æœè®¾ç½®äº†ï¼Œé‚£ä¹ˆ<bean>æ ‡ç­¾ä¸­è®¾ç½®çš„autowireå¦‚æœä¸ºdefaultï¼Œé‚£ä¹ˆåˆ™ä¼šç”¨<beans>æ ‡ç­¾ä¸­è®¾ç½®çš„autowireã€‚

å¯ä»¥å‘ç°XMLä¸­çš„è‡ªåŠ¨æ³¨å…¥æ˜¯æŒºå¼ºå¤§çš„ï¼Œé‚£ä¹ˆé—®é¢˜æ¥äº†ï¼Œä¸ºä»€ä¹ˆæˆ‘ä»¬å¹³æ—¶éƒ½æ˜¯ç”¨çš„@Autowiredæ³¨è§£å‘¢ï¼Ÿè€Œæ²¡æœ‰ç”¨ä¸Šæ–‡è¯´çš„è¿™ç§è‡ªåŠ¨æ³¨å…¥æ–¹å¼å‘¢ï¼Ÿ

@Autowiredæ³¨è§£ç›¸å½“äºXMLä¸­çš„autowireå±æ€§çš„æ³¨è§£æ–¹å¼çš„æ›¿ä»£ã€‚
> @Autowiredæ³¨è§£æä¾›äº†ä¸autowireç›¸åŒçš„åŠŸèƒ½ï¼Œä½†æ˜¯æ‹¥æœ‰æ›´ç»†ç²’åº¦çš„æ§åˆ¶å’Œæ›´å¹¿æ³›çš„é€‚ç”¨æ€§ã€‚

æ³¨æ„ï¼šæ›´ç»†ç²’åº¦çš„æ§åˆ¶ã€‚

XMLä¸­çš„autowireæ§åˆ¶çš„æ˜¯æ•´ä¸ªbeançš„æ‰€æœ‰å±æ€§ï¼Œè€Œ@Autowiredæ³¨è§£æ˜¯ç›´æ¥å†™åœ¨æŸä¸ªå±æ€§ã€æŸä¸ªsetæ–¹æ³•ã€æŸä¸ªæ„é€ æ–¹æ³•ä¸Šçš„ã€‚

å¦‚æœä¸€ä¸ªç±»æœ‰å¤šä¸ªæ„é€ æ–¹æ³•ï¼Œé‚£ä¹ˆå¦‚æœç”¨XMLçš„autowire=constructorï¼Œä½ æ— æ³•æ§åˆ¶åˆ°åº•ç”¨å“ªä¸ªæ„é€ æ–¹æ³•ï¼Œè€Œä½ å¯ä»¥ç”¨@Autowiredæ³¨è§£æ¥ç›´æ¥æŒ‡å®šä½ æƒ³ç”¨å“ªä¸ªæ„é€ æ–¹æ³•ã€‚

åŒæ—¶ï¼Œç”¨@Autowiredæ³¨è§£ï¼Œè¿˜å¯ä»¥æ§åˆ¶ï¼Œå“ªäº›å±æ€§æƒ³è¢«è‡ªåŠ¨æ³¨å…¥ï¼Œå“ªäº›å±æ€§ä¸æƒ³ï¼Œè¿™ä¹Ÿæ˜¯ç»†ç²’åº¦çš„æ§åˆ¶ã€‚

ä½†æ˜¯@Autowiredæ— æ³•åŒºåˆ†byTypeå’ŒbyNameï¼Œ@Autowiredæ˜¯å…ˆbyTypeï¼Œå¦‚æœæ‰¾åˆ°å¤šä¸ªåˆ™byNameã€‚

XMLçš„è‡ªåŠ¨æ³¨å…¥åº•å±‚å…¶å®ä¹Ÿå°±æ˜¯:

- 1. setæ–¹æ³•æ³¨å…¥
- 2. æ„é€ æ–¹æ³•æ³¨å…¥


#### @Autowiredæ³¨è§£çš„è‡ªåŠ¨æ³¨å…¥

ä¸Šæ–‡è¯´äº†@Autowiredæ³¨è§£ï¼Œæ˜¯byTypeå’ŒbyNameçš„ç»“åˆã€‚

@Autowiredæ³¨è§£å¯ä»¥å†™åœ¨ï¼š

- 1. å±æ€§ä¸Šï¼šå…ˆæ ¹æ®å±æ€§ç±»å‹å»æ‰¾Beanï¼Œå¦‚æœæ‰¾åˆ°å¤šä¸ªå†æ ¹æ®å±æ€§åç¡®å®šä¸€ä¸ª
- 2. æ„é€ æ–¹æ³•ä¸Šï¼šå…ˆæ ¹æ®æ–¹æ³•å‚æ•°ç±»å‹å»æ‰¾Beanï¼Œå¦‚æœæ‰¾åˆ°å¤šä¸ªå†æ ¹æ®å‚æ•°åç¡®å®šä¸€ä¸ª
- 3. setæ–¹æ³•ä¸Šï¼šå…ˆæ ¹æ®æ–¹æ³•å‚æ•°ç±»å‹å»æ‰¾Beanï¼Œå¦‚æœæ‰¾åˆ°å¤šä¸ªå†æ ¹æ®å‚æ•°åç¡®å®šä¸€ä¸ª
     è€Œè¿™ç§åº•å±‚åˆ°äº†ï¼š

- 1. å±æ€§æ³¨å…¥
- 2. setæ–¹æ³•æ³¨å…¥
- 3. æ„é€ æ–¹æ³•æ³¨å…¥


## å¯»æ‰¾æ³¨å…¥ç‚¹

åœ¨åˆ›å»ºä¸€ä¸ªBeançš„è¿‡ç¨‹ä¸­ï¼ŒSpringä¼šåˆ©ç”¨AutowiredAnnotationBeanPostProcessorçš„postProcessMergedBeanDefinition()æ‰¾å‡ºæ³¨å…¥ç‚¹å¹¶ç¼“å­˜ï¼Œæ‰¾æ³¨å…¥ç‚¹çš„æµç¨‹ä¸ºï¼š
- 1. éå†å½“å‰ç±»çš„æ‰€æœ‰çš„å±æ€§å­—æ®µField
- 2. æŸ¥çœ‹å­—æ®µä¸Šæ˜¯å¦å­˜åœ¨@Autowiredã€@Valueã€@Injectä¸­çš„å…¶ä¸­ä»»æ„ä¸€ä¸ªï¼Œå­˜åœ¨åˆ™è®¤ä¸ºè¯¥å­—æ®µæ˜¯ä¸€ä¸ªæ³¨å…¥ç‚¹
- 3. å¦‚æœå­—æ®µæ˜¯staticçš„ï¼Œåˆ™ä¸è¿›è¡Œæ³¨å…¥
- 4. è·å–@Autowiredä¸­çš„requiredå±æ€§çš„å€¼
- 5. å°†å­—æ®µä¿¡æ¯æ„é€ æˆä¸€ä¸ªAutowiredFieldElementå¯¹è±¡ï¼Œä½œä¸ºä¸€ä¸ªæ³¨å…¥ç‚¹å¯¹è±¡æ·»åŠ åˆ°currElementsé›†åˆä¸­ã€‚
- 6. éå†å½“å‰ç±»çš„æ‰€æœ‰æ–¹æ³•Method
- 7. åˆ¤æ–­å½“å‰Methodæ˜¯å¦æ˜¯æ¡¥æ¥æ–¹æ³•ï¼Œå¦‚æœæ˜¯æ‰¾åˆ°åŸæ–¹æ³•
- 8. æŸ¥çœ‹æ–¹æ³•ä¸Šæ˜¯å¦å­˜åœ¨@Autowiredã€@Valueã€@Injectä¸­çš„å…¶ä¸­ä»»æ„ä¸€ä¸ªï¼Œå­˜åœ¨åˆ™è®¤ä¸ºè¯¥æ–¹æ³•æ˜¯ä¸€ä¸ªæ³¨å…¥ç‚¹
- 9. å¦‚æœæ–¹æ³•æ˜¯staticçš„ï¼Œåˆ™ä¸è¿›è¡Œæ³¨å…¥
- 10. è·å–@Autowiredä¸­çš„requiredå±æ€§çš„å€¼
- 11. å°†æ–¹æ³•ä¿¡æ¯æ„é€ æˆä¸€ä¸ªAutowiredMethodElementå¯¹è±¡ï¼Œä½œä¸ºä¸€ä¸ªæ³¨å…¥ç‚¹å¯¹è±¡æ·»åŠ åˆ°currElementsé›†åˆä¸­ã€‚
- 12. éå†å®Œå½“å‰ç±»çš„å­—æ®µå’Œæ–¹æ³•åï¼Œå°†éå†çˆ¶ç±»çš„ï¼Œç›´åˆ°æ²¡æœ‰çˆ¶ç±»ã€‚
- 13. æœ€åå°†currElementsé›†åˆå°è£…æˆä¸€ä¸ªInjectionMetadataå¯¹è±¡ï¼Œä½œä¸ºå½“å‰Beanå¯¹äºçš„æ³¨å…¥ç‚¹é›†åˆå¯¹è±¡ï¼Œå¹¶ç¼“å­˜ã€‚


ä¸‹é¢è´´ä¸Šéƒ¨åˆ†ä»£ç ï¼š

```java
@Override
public void postProcessMergedBeanDefinition(RootBeanDefinition beanDefinition, Class<?> beanType, String beanName) {
  InjectionMetadata metadata = findAutowiringMetadata(beanName, beanType, null);
  metadata.checkConfigMembers(beanDefinition);
}
```

```java
@Override
private InjectionMetadata findAutowiringMetadata(String beanName, Class<?> clazz, @Nullable PropertyValues pvs) {
  // Fall back to class name as cache key, for backwards compatibility with custom callers.
  String cacheKey = (StringUtils.hasLength(beanName) ? beanName : clazz.getName());
  // Quick check on the concurrent map first, with minimal locking.
  InjectionMetadata metadata = this.injectionMetadataCache.get(cacheKey);
  if (InjectionMetadata.needsRefresh(metadata, clazz)) {
    synchronized (this.injectionMetadataCache) {
      metadata = this.injectionMetadataCache.get(cacheKey);
      if (InjectionMetadata.needsRefresh(metadata, clazz)) {
        if (metadata != null) {
          metadata.clear(pvs);
        }
        // è§£ææ³¨å…¥ç‚¹å¹¶ç¼“å­˜
        metadata = buildAutowiringMetadata(clazz);
        this.injectionMetadataCache.put(cacheKey, metadata);
      }
    }
  }
  return metadata;
}
```

```java
private InjectionMetadata buildAutowiringMetadata(final Class<?> clazz) {
  // å¦‚æœä¸€ä¸ªBeançš„ç±»å‹æ˜¯String...ï¼Œé‚£ä¹ˆåˆ™æ ¹æœ¬ä¸éœ€è¦è¿›è¡Œä¾èµ–æ³¨å…¥
  if (!AnnotationUtils.isCandidateClass(clazz, this.autowiredAnnotationTypes)) {
    return InjectionMetadata.EMPTY;
  }

  List<InjectionMetadata.InjectedElement> elements = new ArrayList<>();
  Class<?> targetClass = clazz;

  do {
    final List<InjectionMetadata.InjectedElement> currElements = new ArrayList<>();

    // éå†targetClassä¸­çš„æ‰€æœ‰Field
    ReflectionUtils.doWithLocalFields(targetClass, field -> {
      // fieldä¸Šæ˜¯å¦å­˜åœ¨@Autowiredã€@Valueã€@Injectä¸­çš„å…¶ä¸­ä¸€ä¸ª
      MergedAnnotation<?> ann = findAutowiredAnnotation(field);
      if (ann != null) {
        // static filedä¸æ˜¯æ³¨å…¥ç‚¹ï¼Œä¸ä¼šè¿›è¡Œè‡ªåŠ¨æ³¨å…¥
        if (Modifier.isStatic(field.getModifiers())) {
          if (logger.isInfoEnabled()) {
            logger.info("Autowired annotation is not supported on static fields: " + field);
          }
          return;
        }

        // æ„é€ æ³¨å…¥ç‚¹
        boolean required = determineRequiredStatus(ann);
        currElements.add(new AutowiredFieldElement(field, required));
      }
    });

    // éå†targetClassä¸­çš„æ‰€æœ‰Method
    ReflectionUtils.doWithLocalMethods(targetClass, method -> {

      Method bridgedMethod = BridgeMethodResolver.findBridgedMethod(method);
      if (!BridgeMethodResolver.isVisibilityBridgeMethodPair(method, bridgedMethod)) {
        return;
      }
      // methodä¸Šæ˜¯å¦å­˜åœ¨@Autowiredã€@Valueã€@Injectä¸­çš„å…¶ä¸­ä¸€ä¸ª
      MergedAnnotation<?> ann = findAutowiredAnnotation(bridgedMethod);
      if (ann != null && method.equals(ClassUtils.getMostSpecificMethod(method, clazz))) {
        // static methodä¸æ˜¯æ³¨å…¥ç‚¹ï¼Œä¸ä¼šè¿›è¡Œè‡ªåŠ¨æ³¨å…¥
        if (Modifier.isStatic(method.getModifiers())) {
          if (logger.isInfoEnabled()) {
            logger.info("Autowired annotation is not supported on static methods: " + method);
          }
          return;
        }
        // setæ–¹æ³•æœ€å¥½æœ‰å…¥å‚
        if (method.getParameterCount() == 0) {
          if (logger.isInfoEnabled()) {
            logger.info("Autowired annotation should only be used on methods with parameters: " +
                method);
          }
        }
        boolean required = determineRequiredStatus(ann);
        PropertyDescriptor pd = BeanUtils.findPropertyForMethod(bridgedMethod, clazz);
        currElements.add(new AutowiredMethodElement(method, required, pd));
      }
    });

    elements.addAll(0, currElements);
    targetClass = targetClass.getSuperclass();
  }
  while (targetClass != null && targetClass != Object.class);

  return InjectionMetadata.forElements(elements, clazz);
}
```


### staticçš„å­—æ®µæˆ–æ–¹æ³•ä¸ºä»€ä¹ˆä¸æ”¯æŒ

```java
@Component
@Scope("prototype")
public class OrderService {


}
```

```java
@Component
@Scope("prototype")
public class UserService  {

 @Autowired
 private static OrderService orderService;


}
```

UserServiceå’ŒOrderServiceéƒ½æ˜¯åŸå‹Beanï¼Œå‡è®¾Springæ”¯æŒstaticå­—æ®µè¿›è¡Œè‡ªåŠ¨æ³¨å…¥ï¼Œé‚£ä¹ˆç°åœ¨è°ƒç”¨ä¸¤æ¬¡

- UserService userService1 = context.getBean("userService")
- UserService userService2 = context.getBean("userService")

æ­¤æ—¶ï¼ŒuserService1çš„orderServiceå€¼æ˜¯ä»€ä¹ˆï¼Ÿè¿˜æ˜¯å®ƒè‡ªå·±æ³¨å…¥çš„å€¼å—ï¼Ÿ
â€‹
ç­”æ¡ˆæ˜¯:ä¸æ˜¯ï¼Œä¸€æ—¦userService2 åˆ›å»ºå¥½äº†ä¹‹åï¼Œstatic orderServiceå­—æ®µçš„å€¼å°±å‘ç”Ÿäº†ä¿®æ”¹äº†ï¼Œä»è€Œå‡ºç°bugã€‚


### æ¡¥æ¥æ–¹æ³•

```java
public interface UserInterface<T> {
  void setOrderService(T t);
}
```

```java
@Component
public class UserService implements UserInterface<OrderService> {

  private OrderService orderService;

  @Override
  @Autowired
  public void setOrderService(OrderService orderService) {
    this.orderService = orderService;
  }

}
```

## æ³¨å…¥ç‚¹è¿›è¡Œæ³¨å…¥

Springåœ¨AutowiredAnnotationBeanPostProcessorçš„postProcessProperties()æ–¹æ³•ä¸­ï¼Œä¼šéå†æ‰€æ‰¾åˆ°çš„æ³¨å…¥ç‚¹ä¾æ¬¡è¿›è¡Œæ³¨å…¥ã€‚

### å­—æ®µæ³¨å…¥
- 1. éå†æ‰€æœ‰çš„AutowiredFieldElementå¯¹è±¡ã€‚
- 2. å°†å¯¹åº”çš„å­—æ®µå°è£…ä¸ºDependencyDescriptorå¯¹è±¡ã€‚
- 3. è°ƒç”¨BeanFactoryçš„resolveDependency()æ–¹æ³•ï¼Œä¼ å…¥DependencyDescriptorå¯¹è±¡ï¼Œè¿›è¡Œä¾èµ–æŸ¥æ‰¾ï¼Œæ‰¾åˆ°å½“å‰å­—æ®µæ‰€åŒ¹é…çš„Beanå¯¹è±¡ã€‚
- 4. å°†DependencyDescriptorå¯¹è±¡å’Œæ‰€æ‰¾åˆ°çš„ç»“æœå¯¹è±¡beanNameå°è£…æˆä¸€ä¸ªShortcutDependencyDescriptorå¯¹è±¡ä½œä¸ºç¼“å­˜ï¼Œæ¯”å¦‚å¦‚æœå½“å‰Beanæ˜¯åŸå‹Beanï¼Œé‚£ä¹ˆä¸‹æ¬¡å†æ¥åˆ›å»ºè¯¥Beanæ—¶ï¼Œå°±å¯ä»¥ç›´æ¥æ‹¿ç¼“å­˜çš„ç»“æœå¯¹è±¡beanNameå»BeanFactoryä¸­å»é‚£beanå¯¹è±¡äº†ï¼Œä¸ç”¨å†æ¬¡è¿›è¡ŒæŸ¥æ‰¾äº†
- 5. åˆ©ç”¨åå°„å°†ç»“æœå¯¹è±¡èµ‹å€¼ç»™å­—æ®µã€‚
     â€‹

### Setæ–¹æ³•æ³¨å…¥
- 1. éå†æ‰€æœ‰çš„AutowiredMethodElementå¯¹è±¡
- 2. éå†å°†å¯¹åº”çš„æ–¹æ³•çš„å‚æ•°ï¼Œå°†æ¯ä¸ªå‚æ•°å°è£…æˆMethodParameterå¯¹è±¡
- 3. å°†MethodParameterå¯¹è±¡å°è£…ä¸ºDependencyDescriptorå¯¹è±¡
- 4. è°ƒç”¨BeanFactoryçš„resolveDependency()æ–¹æ³•ï¼Œä¼ å…¥DependencyDescriptorå¯¹è±¡ï¼Œè¿›è¡Œä¾èµ–æŸ¥æ‰¾ï¼Œæ‰¾åˆ°å½“å‰æ–¹æ³•å‚æ•°æ‰€åŒ¹é…çš„Beanå¯¹è±¡ã€‚
- 5. å°†DependencyDescriptorå¯¹è±¡å’Œæ‰€æ‰¾åˆ°çš„ç»“æœå¯¹è±¡beanNameå°è£…æˆä¸€ä¸ªShortcutDependencyDescriptorå¯¹è±¡ä½œä¸ºç¼“å­˜ï¼Œæ¯”å¦‚å¦‚æœå½“å‰Beanæ˜¯åŸå‹Beanï¼Œé‚£ä¹ˆä¸‹æ¬¡å†æ¥åˆ›å»ºè¯¥Beanæ—¶ï¼Œå°±å¯ä»¥ç›´æ¥æ‹¿ç¼“å­˜çš„ç»“æœå¯¹è±¡beanNameå»BeanFactoryä¸­å»é‚£beanå¯¹è±¡äº†ï¼Œä¸ç”¨å†æ¬¡è¿›è¡ŒæŸ¥æ‰¾äº†
- 6. åˆ©ç”¨åå°„å°†æ‰¾åˆ°çš„æ‰€æœ‰ç»“æœå¯¹è±¡ä¼ ç»™å½“å‰æ–¹æ³•ï¼Œå¹¶æ‰§è¡Œã€‚

ä¸‹é¢æä¸ŠAutowiredAnnotationBeanPostProcessor#postProcessProperties()çš„ä»£ç 
```java
@Override
public PropertyValues postProcessProperties(PropertyValues pvs, Object bean, String beanName) {
  // æ‰¾æ³¨å…¥ç‚¹ï¼ˆæ‰€æœ‰è¢«@Autowiredæ³¨è§£äº†çš„Fieldæˆ–Methodï¼‰
  InjectionMetadata metadata = findAutowiringMetadata(beanName, bean.getClass(), pvs);
  try {
    metadata.inject(bean, beanName, pvs);
  }
  catch (BeanCreationException ex) {
    throw ex;
  }
  catch (Throwable ex) {
    throw new BeanCreationException(beanName, "Injection of autowired dependencies failed", ex);
  }
  return pvs;
}
```

```java
public void inject(Object target, @Nullable String beanName, @Nullable PropertyValues pvs) throws Throwable {
  Collection<InjectedElement> checkedElements = this.checkedElements;
  Collection<InjectedElement> elementsToIterate =
      (checkedElements != null ? checkedElements : this.injectedElements);
  if (!elementsToIterate.isEmpty()) {
    // éå†æ¯ä¸ªæ³¨å…¥ç‚¹è¿›è¡Œä¾èµ–æ³¨å…¥
    for (InjectedElement element : elementsToIterate) {
      element.inject(target, beanName, pvs);
    }
  }
}
```

```java
@Override
protected void inject(Object bean, @Nullable String beanName, @Nullable PropertyValues pvs) throws Throwable {

  Field field = (Field) this.member;
  Object value;
  if (this.cached) {
    // å¯¹äºåŸå‹Beanï¼Œç¬¬ä¸€æ¬¡åˆ›å»ºçš„æ—¶å€™ï¼Œä¹Ÿæ‰¾æ³¨å…¥ç‚¹ï¼Œç„¶åè¿›è¡Œæ³¨å…¥ï¼Œæ­¤æ—¶cachedä¸ºfalseï¼Œæ³¨å…¥å®Œäº†ä¹‹åcachedä¸ºtrue
    // ç¬¬äºŒæ¬¡åˆ›å»ºçš„æ—¶å€™ï¼Œå…ˆæ‰¾æ³¨å…¥ç‚¹ï¼ˆæ­¤æ—¶ä¼šæ‹¿åˆ°ç¼“å­˜å¥½çš„æ³¨å…¥ç‚¹ï¼‰ï¼Œä¹Ÿå°±æ˜¯AutowiredFieldElementå¯¹è±¡ï¼Œæ­¤æ—¶cacheä¸ºtrueï¼Œä¹Ÿå°±è¿›åˆ°æ­¤å¤„äº†
    // æ³¨å…¥ç‚¹å†…å¹¶æ²¡æœ‰ç¼“å­˜è¢«æ³¨å…¥çš„å…·ä½“Beanå¯¹è±¡ï¼Œè€Œæ˜¯beanNameï¼Œè¿™æ ·å°±èƒ½ä¿è¯æ³¨å…¥åˆ°ä¸åŒçš„åŸå‹Beanå¯¹è±¡
    try {
      value = resolvedCachedArgument(beanName, this.cachedFieldValue);
    }
    catch (NoSuchBeanDefinitionException ex) {
      // Unexpected removal of target bean for cached argument -> re-resolve
      value = resolveFieldValue(field, bean, beanName);
    }
  }
  else {
    // æ ¹æ®filedä»BeanFactoryä¸­æŸ¥åˆ°çš„åŒ¹é…çš„Beanå¯¹è±¡
    value = resolveFieldValue(field, bean, beanName);
  }

  // åå°„ç»™filedèµ‹å€¼
  if (value != null) {
    ReflectionUtils.makeAccessible(field);
    field.set(bean, value);
  }
}
```

```java
@Nullable
private Object resolvedCachedArgument(@Nullable String beanName, @Nullable Object cachedArgument) {
  if (cachedArgument instanceof DependencyDescriptor) {
    // ShortcutDependencyDescriptor
    DependencyDescriptor descriptor = (DependencyDescriptor) cachedArgument;
    Assert.state(this.beanFactory != null, "No BeanFactory available");
    //è°ƒç”¨DefaultListableBeanFactoryçš„resolveDependency
    return this.beanFactory.resolveDependency(descriptor, beanName, null, null);
  }
  else {
    return cachedArgument;
  }
}
```
æ³¨æ„ä¸‹é¢è¿™æ®µä»£ç ã€‚è¯¥æ–¹æ³•è¡¨ç¤ºï¼šä¼ å…¥ä¸€ä¸ªä¾èµ–æè¿°ï¼ˆDependencyDescriptorï¼‰ï¼Œè¯¥æ–¹æ³•ä¼šæ ¹æ®è¯¥ä¾èµ–æè¿°ä»BeanFactoryä¸­æ‰¾å‡ºå¯¹åº”çš„å”¯ä¸€çš„ä¸€ä¸ªBeanå¯¹è±¡ã€‚
```java
@Override
@Nullable
public Object resolveDependency(DependencyDescriptor descriptor, @Nullable String requestingBeanName,
    @Nullable Set<String> autowiredBeanNames, @Nullable TypeConverter typeConverter) throws BeansException {
  // ç”¨æ¥è·å–æ–¹æ³•å…¥å‚åå­—çš„
  descriptor.initParameterNameDiscovery(getParameterNameDiscoverer());

  // æ‰€éœ€è¦çš„ç±»å‹æ˜¯Optional
  if (Optional.class == descriptor.getDependencyType()) {
    return createOptionalDependency(descriptor, requestingBeanName);
  }
  // æ‰€éœ€è¦çš„çš„ç±»å‹æ˜¯ObjectFactoryï¼Œæˆ–ObjectProvider
  else if (ObjectFactory.class == descriptor.getDependencyType() ||
      ObjectProvider.class == descriptor.getDependencyType()) {
    return new DependencyObjectProvider(descriptor, requestingBeanName);
  }
  else if (javaxInjectProviderClass == descriptor.getDependencyType()) {
    return new Jsr330Factory().createDependencyProvider(descriptor, requestingBeanName);
  }
  else {
    // åœ¨å±æ€§æˆ–setæ–¹æ³•ä¸Šä½¿ç”¨äº†@Lazyæ³¨è§£ï¼Œé‚£ä¹ˆåˆ™æ„é€ ä¸€ä¸ªä»£ç†å¯¹è±¡å¹¶è¿”å›ï¼ŒçœŸæ­£ä½¿ç”¨è¯¥ä»£ç†å¯¹è±¡æ—¶æ‰è¿›è¡Œç±»å‹ç­›é€‰Bean
    Object result = getAutowireCandidateResolver().getLazyResolutionProxyIfNecessary(
        descriptor, requestingBeanName);

    if (result == null) {
      // descriptorè¡¨ç¤ºæŸä¸ªå±æ€§æˆ–æŸä¸ªsetæ–¹æ³•
      // requestingBeanNameè¡¨ç¤ºæ­£åœ¨è¿›è¡Œä¾èµ–æ³¨å…¥çš„Bean
      result = doResolveDependency(descriptor, requestingBeanName, autowiredBeanNames, typeConverter);
    }
    return result;
  }
}
```

å…·ä½“æµç¨‹å›¾å¦‚ä¸‹ï¼š

![resolveDependencyåŸç†.drawio.png](https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/79d7dce8ee1944c28856cb52a965c3cf~tplv-k3u1fbpfcp-watermark.image?)


## findAutowireCandidates()å®ç°

æ ¹æ®ç±»å‹æ‰¾beanNameçš„åº•å±‚æµç¨‹


![æ ¹æ®ç±»å‹æ‰¾beanNameçš„åº•å±‚æµç¨‹.drawio.png](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/1cefb28742d545f5b0808269b987b3bd~tplv-k3u1fbpfcp-watermark.image?)

å¯¹åº”æ‰§è¡Œæµç¨‹å›¾ä¸º

![ä¾èµ–æ³¨å…¥æµç¨‹å›¾.drawio.png](https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/aab8659173c5429d845b4ccdc494c443~tplv-k3u1fbpfcp-watermark.image?)


>  1. æ‰¾å‡ºBeanFactoryä¸­ç±»å‹ä¸ºtypeçš„æ‰€æœ‰çš„Beançš„åå­—ï¼Œæ³¨æ„æ˜¯åå­—ï¼Œè€Œä¸æ˜¯Beanå¯¹è±¡ï¼Œå› ä¸ºæˆ‘ä»¬å¯ä»¥æ ¹æ®BeanDefinitionå°±èƒ½åˆ¤æ–­å’Œå½“å‰typeæ˜¯ä¸æ˜¯åŒ¹é…ï¼Œä¸ç”¨ç”ŸæˆBeanå¯¹è±¡
>  2. æŠŠresolvableDependenciesä¸­keyä¸ºtypeçš„å¯¹è±¡æ‰¾å‡ºæ¥å¹¶æ·»åŠ åˆ°resultä¸­
>  3. éå†æ ¹æ®typeæ‰¾å‡ºçš„beanNameï¼Œåˆ¤æ–­å½“å‰beanNameå¯¹åº”çš„Beanæ˜¯ä¸æ˜¯èƒ½å¤Ÿè¢«è‡ªåŠ¨æ³¨å…¥
>  4. å…ˆåˆ¤æ–­beanNameå¯¹åº”çš„BeanDefinitionä¸­çš„autowireCandidateå±æ€§ï¼Œå¦‚æœä¸ºfalseï¼Œè¡¨ç¤ºä¸èƒ½ç”¨æ¥è¿›è¡Œè‡ªåŠ¨æ³¨å…¥ï¼Œå¦‚æœä¸ºtrueåˆ™ç»§ç»­è¿›è¡Œåˆ¤æ–­
>  5. åˆ¤æ–­å½“å‰typeæ˜¯ä¸æ˜¯æ³›å‹ï¼Œå¦‚æœæ˜¯æ³›å‹æ˜¯ä¼šæŠŠå®¹å™¨ä¸­æ‰€æœ‰çš„beanNameæ‰¾å‡ºæ¥çš„ï¼Œå¦‚æœæ˜¯è¿™ç§æƒ…å†µï¼Œé‚£ä¹ˆåœ¨è¿™ä¸€æ­¥ä¸­å°±è¦è·å–åˆ°æ³›å‹çš„çœŸæ­£ç±»å‹ï¼Œç„¶åè¿›è¡ŒåŒ¹é…ï¼Œå¦‚æœå½“å‰beanNameå’Œå½“å‰æ³›å‹å¯¹åº”çš„çœŸå®ç±»å‹åŒ¹é…ï¼Œé‚£ä¹ˆåˆ™ç»§ç»­åˆ¤æ–­
>  6. å¦‚æœå½“å‰DependencyDescriptorä¸Šå­˜åœ¨@Qualifieræ³¨è§£ï¼Œé‚£ä¹ˆåˆ™è¦åˆ¤æ–­å½“å‰beanNameä¸Šæ˜¯å¦å®šä¹‰äº†Qualifierï¼Œå¹¶ä¸”æ˜¯å¦å’Œå½“å‰DependencyDescriptorä¸Šçš„Qualifierç›¸ç­‰ï¼Œç›¸ç­‰åˆ™åŒ¹é…
>  7. ç»è¿‡ä¸Šè¿°éªŒè¯ä¹‹åï¼Œå½“å‰beanNameæ‰èƒ½æˆä¸ºä¸€ä¸ªå¯æ³¨å…¥çš„ï¼Œæ·»åŠ åˆ°resultä¸­


## å…³äºä¾èµ–æ³¨å…¥ä¸­æ³›å‹æ³¨å…¥çš„å®ç°

é¦–å…ˆåœ¨Javaåå°„ä¸­ï¼Œæœ‰ä¸€ä¸ªTypeæ¥å£ï¼Œè¡¨ç¤ºç±»å‹ï¼Œå…·ä½“åˆ†ç±»ä¸ºï¼š

- 1. raw typesï¼šä¹Ÿå°±æ˜¯æ™®é€šClass
- 2. parameterized typesï¼šå¯¹åº”ParameterizedTypeæ¥å£ï¼Œæ³›å‹ç±»å‹
- 3. array typesï¼šå¯¹åº”GenericArrayTypeï¼Œæ³›å‹æ•°ç»„
- 4. type variablesï¼šå¯¹åº”TypeVariableæ¥å£ï¼Œè¡¨ç¤ºç±»å‹å˜é‡ï¼Œä¹Ÿå°±æ˜¯æ‰€å®šä¹‰çš„æ³›å‹ï¼Œæ¯”å¦‚Tã€K
- 5. primitive typesï¼šåŸºæœ¬ç±»å‹ï¼Œintã€boolean

```java
package com.fandf.service;

import java.lang.reflect.Field;
import java.lang.reflect.GenericArrayType;
import java.lang.reflect.ParameterizedType;
import java.lang.reflect.TypeVariable;
import java.util.List;

public class TypeTest<T> {

	private int i;
	private Integer it;
	private int[] iarray;
	private List list;
	private List<String> slist;
	private List<T> tlist;
	private T t;
	private T[] tarray;

	public static void main(String[] args) throws NoSuchFieldException {

		test(TypeTest.class.getDeclaredField("i"));
		System.out.println("=======");
		test(TypeTest.class.getDeclaredField("it"));
		System.out.println("=======");
		test(TypeTest.class.getDeclaredField("iarray"));
		System.out.println("=======");
		test(TypeTest.class.getDeclaredField("list"));
		System.out.println("=======");
		test(TypeTest.class.getDeclaredField("slist"));
		System.out.println("=======");
		test(TypeTest.class.getDeclaredField("tlist"));
		System.out.println("=======");
		test(TypeTest.class.getDeclaredField("t"));
		System.out.println("=======");
		test(TypeTest.class.getDeclaredField("tarray"));

	}

	public static void test(Field field) {

		if (field.getType().isPrimitive()) {
			System.out.println(field.getName() + "æ˜¯åŸºæœ¬æ•°æ®ç±»å‹");
		} else {
			System.out.println(field.getName() + "ä¸æ˜¯åŸºæœ¬æ•°æ®ç±»å‹");
		}

		if (field.getGenericType() instanceof ParameterizedType) {
			System.out.println(field.getName() + "æ˜¯æ³›å‹ç±»å‹");
		} else {
			System.out.println(field.getName() + "ä¸æ˜¯æ³›å‹ç±»å‹");
		}

		if (field.getType().isArray()) {
			System.out.println(field.getName() + "æ˜¯æ™®é€šæ•°ç»„");
		} else {
			System.out.println(field.getName() + "ä¸æ˜¯æ™®é€šæ•°ç»„");
		}

		if (field.getGenericType() instanceof GenericArrayType) {
			System.out.println(field.getName() + "æ˜¯æ³›å‹æ•°ç»„");
		} else {
			System.out.println(field.getName() + "ä¸æ˜¯æ³›å‹æ•°ç»„");
		}

		if (field.getGenericType() instanceof TypeVariable) {
			System.out.println(field.getName() + "æ˜¯æ³›å‹å˜é‡");
		} else {
			System.out.println(field.getName() + "ä¸æ˜¯æ³›å‹å˜é‡");
		}

	}

}
```

æ‰“å°ç»“æœå¦‚ä¸‹

```java
iæ˜¯åŸºæœ¬æ•°æ®ç±»å‹
iä¸æ˜¯æ³›å‹ç±»å‹
iä¸æ˜¯æ™®é€šæ•°ç»„
iä¸æ˜¯æ³›å‹æ•°ç»„
iä¸æ˜¯æ³›å‹å˜é‡
=======
itä¸æ˜¯åŸºæœ¬æ•°æ®ç±»å‹
itä¸æ˜¯æ³›å‹ç±»å‹
itä¸æ˜¯æ™®é€šæ•°ç»„
itä¸æ˜¯æ³›å‹æ•°ç»„
itä¸æ˜¯æ³›å‹å˜é‡
=======
iarrayä¸æ˜¯åŸºæœ¬æ•°æ®ç±»å‹
iarrayä¸æ˜¯æ³›å‹ç±»å‹
iarrayæ˜¯æ™®é€šæ•°ç»„
iarrayä¸æ˜¯æ³›å‹æ•°ç»„
iarrayä¸æ˜¯æ³›å‹å˜é‡
=======
listä¸æ˜¯åŸºæœ¬æ•°æ®ç±»å‹
listä¸æ˜¯æ³›å‹ç±»å‹
listä¸æ˜¯æ™®é€šæ•°ç»„
listä¸æ˜¯æ³›å‹æ•°ç»„
listä¸æ˜¯æ³›å‹å˜é‡
=======
slistä¸æ˜¯åŸºæœ¬æ•°æ®ç±»å‹
slistæ˜¯æ³›å‹ç±»å‹
slistä¸æ˜¯æ™®é€šæ•°ç»„
slistä¸æ˜¯æ³›å‹æ•°ç»„
slistä¸æ˜¯æ³›å‹å˜é‡
=======
tlistä¸æ˜¯åŸºæœ¬æ•°æ®ç±»å‹
tlistæ˜¯æ³›å‹ç±»å‹
tlistä¸æ˜¯æ™®é€šæ•°ç»„
tlistä¸æ˜¯æ³›å‹æ•°ç»„
tlistä¸æ˜¯æ³›å‹å˜é‡
=======
tä¸æ˜¯åŸºæœ¬æ•°æ®ç±»å‹
tä¸æ˜¯æ³›å‹ç±»å‹
tä¸æ˜¯æ™®é€šæ•°ç»„
tä¸æ˜¯æ³›å‹æ•°ç»„
tæ˜¯æ³›å‹å˜é‡
=======
tarrayä¸æ˜¯åŸºæœ¬æ•°æ®ç±»å‹
tarrayä¸æ˜¯æ³›å‹ç±»å‹
tarrayæ˜¯æ™®é€šæ•°ç»„
tarrayæ˜¯æ³›å‹æ•°ç»„
tarrayä¸æ˜¯æ³›å‹å˜é‡
```

Springä¸­ï¼Œå½“æ³¨å…¥ç‚¹æ˜¯ä¸€ä¸ªæ³›å‹æ—¶ï¼Œä¹Ÿæ˜¯ä¼šè¿›è¡Œå¤„ç†çš„ï¼Œæ¯”å¦‚ï¼š

```
@Component
public class UserService extends BaseService<OrderService, StockService> {

    public void test() {
        System.out.println(o);
    }

}

public class BaseService<O, S> {

    @Autowired
    protected O o;

    @Autowired
    protected S s;
}
```

- 1. Springæ‰«ææ—¶å‘ç°UserServiceæ˜¯ä¸€ä¸ªBean
- 2. é‚£å°±å–å‡ºæ³¨å…¥ç‚¹ï¼Œä¹Ÿå°±æ˜¯BaseServiceä¸­çš„ä¸¤ä¸ªå±æ€§oã€s
- 3. æ¥ä¸‹æ¥éœ€è¦æŒ‰æ³¨å…¥ç‚¹ç±»å‹è¿›è¡Œæ³¨å…¥ï¼Œä½†æ˜¯oå’Œséƒ½æ˜¯æ³›å‹ï¼Œæ‰€ä»¥Springéœ€è¦ç¡®å®šoå’Œsçš„å…·ä½“ç±»å‹ã€‚
- 4. å› ä¸ºå½“å‰æ­£åœ¨åˆ›å»ºçš„æ˜¯UserServiceçš„Beanï¼Œæ‰€ä»¥å¯ä»¥é€šè¿‡userService.getClass().getGenericSuperclass().getTypeName()è·å–åˆ°å…·ä½“çš„æ³›å‹ä¿¡æ¯ï¼Œæ¯”å¦‚com.zhouyu.service.BaseService<com.zhouyu.service.OrderService, com.zhouyu.service.StockService>
- 5. ç„¶åå†æ‹¿åˆ°UserServiceçš„çˆ¶ç±»BaseServiceçš„æ³›å‹å˜é‡ï¼š for (TypeVariable<? extends Class<?>> typeParameter : userService.getClass().getSuperclass().getTypeParameters()) { System._out_.println(typeParameter.getName()); }
- 6. é€šè¿‡ä¸Šé¢ä¸¤æ®µä»£ç ï¼Œå°±èƒ½çŸ¥é“ï¼Œoå¯¹åº”çš„å…·ä½“å°±æ˜¯OrderServiceï¼Œså¯¹åº”çš„å…·ä½“ç±»å‹å°±æ˜¯StockService
- 7. ç„¶åå†è°ƒç”¨oField.getGenericType()å°±çŸ¥é“å½“å‰fieldä½¿ç”¨çš„æ˜¯å“ªä¸ªæ³›å‹ï¼Œå°±èƒ½çŸ¥é“å…·ä½“ç±»å‹äº†

## @Qualifierçš„ä½¿ç”¨

å®šä¹‰ä¸¤ä¸ªæ³¨è§£

```java
@Target({ElementType.TYPE, ElementType.FIELD})
@Retention(RetentionPolicy.RUNTIME)
@Qualifier("random")
public @interface Random {
}
```

```java
@Target({ElementType.TYPE, ElementType.FIELD})
@Retention(RetentionPolicy.RUNTIME)
@Qualifier("roundRobin")
public @interface RoundRobin {
}
```

å®šä¹‰ä¸€ä¸ªæ¥å£å’Œä¸¤ä¸ªå®ç°ç±»ï¼Œè¡¨ç¤ºè´Ÿè½½å‡è¡¡ï¼š

```java
public interface LoadBalance {
    String select();
}
```

```java
@Component
@Random
public class RandomStrategy implements LoadBalance {

    @Override
    public String select() {
        return null;
    }
}
```

```java
@Component
@RoundRobin
public class RoundRobinStrategy implements LoadBalance {

    @Override
    public String select() {
        return null;
    }
}
```

ä½¿ç”¨ï¼š

```java
@Component
public class UserService {

    @Autowired
    @RoundRobin
    private LoadBalance loadBalance;

    public void test() {
        System.out.println(loadBalance);
    }

}
```

## @Resourceæ³¨è§£

@Resourceæ³¨è§£åº•å±‚å·¥ä½œæµç¨‹å›¾ï¼š

![@Resourceæ³¨è§£åº•å±‚å·¥ä½œæµç¨‹å›¾.drawio.png](https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/39645beab9ea4c73999da62c9d4b9429~tplv-k3u1fbpfcp-watermark.image?)










