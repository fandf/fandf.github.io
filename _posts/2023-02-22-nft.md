---
layout: post
title: NFTç›²ç›’å¼€å‘
date: 2023-02-22
tags: [NFT]
description: æ¬²ä¹°æ¡‚èŠ±åŒè½½é…’ï¼Œç»ˆä¸ä¼¼ï¼Œå°‘å¹´æ¸¸
---

>æœ€è¿‘å‡ å¹´NFTç«çš„ä¸€å¡Œç³Šæ¶‚ï¼Œå„ç§æ•°è—å±‚å‡ºä¸ç©·ã€‚  
>å¤šæ•°éƒ½æ˜¯é‡‡ç”¨äº†ç›²ç›’æ¨¡å¼æ¥ç©ï¼Œå³è´­ä¹°çš„æ—¶å€™å¹¶ä¸çŸ¥é“é‡Œé¢æ˜¯ä»€ä¹ˆï¼Œç­‰åˆ°äº†ä¸€å®šçš„æ—¶é—´åï¼Œç›²ç›’å¼€å¯æ‰ä¼šçŸ¥é“ä½ ä¹°çš„ NFT çš„å…·ä½“å±æ€§ï¼Œæ˜¯å¦ç¨€æœ‰ç­‰ã€‚  
> ä»Šå¤©ä¸è®¨è®ºè¥é”€çš„æ¨¡å¼ï¼Œå•çº¯ä»æŠ€æœ¯è§’åº¦å‡ºå‘ï¼Œå¦‚ä½•åˆ¶ä½œå‡ºç›²ç›’æ¨¡å¼çš„NFTã€‚

## ç¼–å†™æ™ºèƒ½åˆçº¦

```java
// SPDX-License-Identifier: MIT
pragma solidity ^0.8.4;
import "@openzeppelin/contracts/token/ERC721/ERC721.sol";
import "@openzeppelin/contracts/token/ERC721/extensions/ERC721URIStorage.sol";
import "@openzeppelin/contracts/token/ERC721/extensions/ERC721Burnable.sol";
import "@openzeppelin/contracts/access/AccessControl.sol";
import "@openzeppelin/contracts/utils/Counters.sol";

/// @custom:security-contact bluequin@163.com
contract FdfNFT is ERC721, ERC721URIStorage, ERC721Burnable, AccessControl {
    using Counters for Counters.Counter;
    //æ˜¯å¦å¼€å¯ç›²ç›’
    bool private _blindBoxOpened = false;
    //è®¾ç½®ç›²ç›’uri
    string baseUri;
    bytes32 public constant MINTER_ROLE = keccak256("MINTER_ROLE");
    Counters.Counter private _tokenIdCounter;

    constructor() ERC721("FDF20220325FNFT", "FDF20220325FNFT") {
      _grantRole(DEFAULT_ADMIN_ROLE, msg.sender);
      _grantRole(MINTER_ROLE, msg.sender);
    }

    function setBaseUri(string memory _baseUri) public {

        require(
            hasRole(DEFAULT_ADMIN_ROLE, _msgSender()),
            "BaseERC721Uri: only admin can do this action"
        );
        baseUri = _baseUri;
    }

    function setBlindBoxOpened(bool _status) public {
        require(
            hasRole(DEFAULT_ADMIN_ROLE, _msgSender()),
            "BaseERC721BlindBox: only admin can do this action"
        );
        _blindBoxOpened = _status;
    }


    function safeMint(address to, string memory uri) public onlyRole(MINTER_ROLE) {
        uint256 tokenId = _tokenIdCounter.current();
        _tokenIdCounter.increment();
        _safeMint(to, tokenId);
        _setTokenURI(tokenId, uri);
    }

    // The following functions are overrides required by Solidity.
    function _burn(uint256 tokenId) internal override(ERC721, ERC721URIStorage) {
        super._burn(tokenId);
    }


    function tokenURI(uint256 tokenId)
        public
        view
        virtual
        override(ERC721, ERC721URIStorage)
        returns (string memory)
    {
        if(_blindBoxOpened){
            return super.tokenURI(tokenId);
        }else {
            return baseUri;
        }
    }

    function supportsInterface(bytes4 interfaceId)
        public
        view
        override(ERC721, AccessControl)
        returns (bool)
    {
        return super.supportsInterface(interfaceId);
    }

}
```

## å‘å¸ƒåˆçº¦åˆ° rinkeby æµ‹è¯•ç¯å¢ƒ

è¿™é‡Œç›´æ¥ç”¨ remix å‘å¸ƒå°±è¡Œ

![](https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/ac272e2c83f04c30a608d95d98d48a8c~tplv-k3u1fbpfcp-watermark.image?)
åœ¨æµè§ˆå™¨ä¸­æŸ¥çœ‹åˆçº¦éƒ¨ç½²æƒ…å†µã€‚
![](https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/a2bb3c570a3e4a0892948c97fb0db056~tplv-k3u1fbpfcp-watermark.image?)
è¿™é‡Œçœ‹åˆ°åˆçº¦å·²ç»åˆ›å»ºæˆåŠŸï¼Œåˆçº¦åœ°å€ 0x5a501c079DB0BeB9A50aCA810be9d7277080E1B4
![](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/cd010ae291c1456c852aff8e7790d20f~tplv-k3u1fbpfcp-watermark.image?)

## ç¼–å†™å›¾ç‰‡æœåŠ¡å™¨æ¥å£

å›¾ç‰‡å¯ä»¥ä¸Šä¼ åˆ° ipfs,ä½†è€ƒè™‘åˆ°éœ€è¦æ”¶é¢å¤–çš„æ‰‹ç»­è´¹ï¼Œä»¥åŠæ›´åŠ çµæ´»çš„å’Œå‰ç«¯è°ƒç”¨ï¼Œæ‰€ä»¥è¿™é‡Œé‡‡ç”¨è‡ªå·±ç¼–å†™æœåŠ¡å™¨æ¥å£  
![](https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/64964d55255b45d3aa2909c1a1d1cb44~tplv-k3u1fbpfcp-watermark.image?)
æ¥å£ä»£ç ï¼Œè¿™é‡Œä½¿ç”¨ java ç¼–å†™  
![](https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/c1a176eea120478b9ae81aadba41c9cb~tplv-k3u1fbpfcp-watermark.image?)

```mysql
CREATE TABLE `test` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `name` varchar(255) COLLATE utf8mb4_unicode_ci DEFAULT NULL,
  `description` varchar(255) COLLATE utf8mb4_unicode_ci DEFAULT NULL,
  `image` varchar(255) COLLATE utf8mb4_unicode_ci DEFAULT NULL,
  PRIMARY KEY (`id`)
) ENGINE=InnoDB AUTO_INCREMENT=9 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

INSERT INTO `test` (`id`, `name`, `description`, `image`) VALUES (1, 'å¼€å¯ç›²ç›’ï¼Œå•è½¦å˜æ‘©æ‰˜', 'å¼€å¯ç›²ç›’ï¼Œå•è½¦å˜æ‘©æ‰˜', 'https://lh3.googleusercontent.com/Op-cRm7h8p34PvxvzZbHh5nAmkS2rVZYil1lUYfyKrI4WuEOTG9X3_C1KvtlXGdyfwG_5wyfyOBwIytw9JZVcAkPtXq4PAdLOsmS=w340');
INSERT INTO `test` (`id`, `name`, `description`, `image`) VALUES (2, '111', 'æœ‹å…‹æ±½è½¦', 'https://img01.jituwang.com/190326/256609-1Z326042P376.jpg');
INSERT INTO `test` (`id`, `name`, `description`, `image`) VALUES (3, '222', 'æœ‹å…‹', 'https://img01.jituwang.com/190330/256613-1Z33016444621.jpg');
INSERT INTO `test` (`id`, `name`, `description`, `image`) VALUES (4, '333', 'æœ‹å…‹', 'https://pic.ntimg.cn/file/20220107/32652940_141026506103_2.jpg');
INSERT INTO `test` (`id`, `name`, `description`, `image`) VALUES (5, '444', 'é‡‘å…‹æ–¯', 'https://pic.ntimg.cn/file/20220218/33805678_164928525106_2.jpg');
INSERT INTO `test` (`id`, `name`, `description`, `image`) VALUES (6, '555', 'æºè®¡åˆ’', 'https://img0.baidu.com/it/u=2501200624,302351145&fm=253&fmt=auto&app=138&f=PNG');
INSERT INTO `test` (`id`, `name`, `description`, `image`) VALUES (7, '666', 'æºè®¡åˆ’', 'https://img2.baidu.com/it/u=2016764601,1618302265&fm=253&fmt=auto&app=138&f=PNG');
INSERT INTO `test` (`id`, `name`, `description`, `image`) VALUES (8, '777', 'æœªæ¥æˆ˜å£«', 'https://img0.baidu.com/it/u=718823970,501814686&fm=253&fmt=auto&app=138&f=PNG');

```

æ¥å£è¿”å› json ç»“æ„æ•°æ®ã€‚åŒ…å«ä¸‰ä¸ªå­—æ®µ  
image:å›¾ç‰‡çœŸå®åœ°å€  
name:å›¾ç‰‡åç§°  
description:å›¾ç‰‡æè¿°

## é“¸é€  NFT

1.è°ƒç”¨ setBaseUri æ–¹æ³•ï¼Œè®¾ç½® baseUri ä¸ºç›²ç›’å›¾ç‰‡
![](https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/88efa67368e642f98b29070cb64fefe8~tplv-k3u1fbpfcp-watermark.image?)  
2.è°ƒç”¨ safeMint æ–¹æ³•é“¸é€  nft

![](https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/cf27199f010b4abba2613f2ee4ebc4fe~tplv-k3u1fbpfcp-watermark.image?)  
è¿™é‡Œå¤šåˆ›å»ºå‡ ä¸ª

## è¿›å…¥ opensea æµ‹è¯•ç½‘æŸ¥çœ‹

https://testnets.opensea.io/

![](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/9c6370c20d5c4b33bc1c29dd1d4a0d08~tplv-k3u1fbpfcp-watermark.image?)

![](https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/75db693d17b34bd4b24b8f68c19f849e~tplv-k3u1fbpfcp-watermark.image?)

![](https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/095f7b69ff224d25b947257ae4f4d52e~tplv-k3u1fbpfcp-watermark.image?)

![](https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/bace3f4903a74d8d925cbb180ec35158~tplv-k3u1fbpfcp-watermark.image?)
å¯ä»¥çœ‹åˆ° nft ç›²ç›’å¦‚ä¸‹

![](https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/b549e6ac3fc347a5892ba497383b7a00~tplv-k3u1fbpfcp-watermark.image?)

## å¼€å¯ç›²ç›’

è°ƒç”¨ setBlindBoxOpened æ–¹æ³•å¼€å¯ç›²ç›’

![](https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/686415bf6673464aae6ad52678ec3a1b~tplv-k3u1fbpfcp-watermark.image?)  
refresh metadata

![](https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/5911e5b312e04bedbcbdaaf7886a41bf~tplv-k3u1fbpfcp-watermark.image?)
å¯ä»¥çœ‹åˆ°æ‰€æœ‰å›¾ç‰‡éƒ½å·²ç»å±•ç¤ºå‡ºæ¥äº†ã€‚ï¼ˆä¸¤å¼ å›¾ç‰‡ä¾ç„¶ä¸ºç›²ç›’ï¼Œæ˜¯å› ä¸ºæˆ‘é“¸é€  NFT çš„æ—¶å€™ï¼Œå›¾ç‰‡å°±æ˜¯ç›²ç›’å›¾ç‰‡ï¼Œå°´å°¬ä¸€ä¸‹ ğŸ˜“ï¼‰